<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google" content="notranslate" />

    <title>My Editor</title>
    <link rel="shortcut icon" href="#" type="image/x-icon">

    <link rel="stylesheet" href="dist/myeditor.css">
</head>

<style>
    body {
        margin: 0px;
        padding: 0px;
    }

    /*
         Need js for custom resize handle??? :
         https://spin.atomicobject.com/2019/11/21/creating-a-resizable-html-element
         */
    #editor {
        height: 60vh;
        resize: vertical;
        overflow: hidden;
        border: 1px solid silver;
    }

    editor-other {
        height: 40vh;
    }
</style>

<body>
    <p>
    <h2>Editor in shadow DOM</h2>
    </p>

    <div id="buttons">
        <button type="button" onclick="printHTML()">Print HTML to dev console</button>|
        <button type="button" onclick="clearContent()">Clear content</button>|

        <input type="color" onfocusout="getColorAndClose(this, event)" onchange="getColorAndClose(this, event)" list="myeditor-color-set" style="display: none;" placeholder="Set color" />
        <datalist id="color-set">
            <option value="#000000"></option>
            <option value="#333333"></option>
            <option value="#666666"></option>
            <option value="#999999"></option>
            <option value="#cccccc"></option>

            <option value="#ff0000">Red</option>
            <option value="#ffa500">Orange</option>
            <option value="#ffff00">Yellow</option>
            <option value="#008000">Green</option>
            <option value="#0000ff">Blue</option>
            <option value="#4b0082">Indigo</option>
            <option value="#ee82ee">Violet</option>
        </datalist>
        <button onclick="showColorPicker(event)">Text Color</button>
    </div>
    <div id="editor"></div>

    <p>
    <h2>Editor in DOM</h2>
    </p>

    <div>
        <editor-other id="editor2-1" data-idx="1"></editor-other>
    </div>

</body>

<!-- Comment modification editor -->
<template id="editor2-template">
    <link rel="stylesheet" href="dist/myeditor.css">
    <script src="dist/myeditor.js"></script>

    <div class="editor2-container">
        <div id="editor2"></div>
    </div>

    <style>
        #editor2 {
            height: 10vh;
            resize: vertical;
            /* overflow: auto; */
            overflow: hidden;

            border: 1px solid silver;
        }
    </style>
</template>
<!-- Comment modification editor -->

<script>"use strict";</script>

<script>
    function showColorPicker(event) {
        const colorPicker = document.querySelector('input[type=color]')

        colorPicker.style.display = "none"

        colorPicker.style.color = "transparent"
        colorPicker.style.backgroundColor = "transparent"
        colorPicker.style.border = "0px solid transparent"

        colorPicker.style.position = "absolute"
        colorPicker.style.left = `${event.pageX}px`
        colorPicker.style.top = `${event.pageY}px`

        colorPicker.style.width = "1px"
        colorPicker.style.height = "1px"
        colorPicker.style.display = "block"

        colorPicker.style.zIndex = "-1"

        colorPicker.focus()
        setTimeout(() => { colorPicker.click() }, 100)
    }

    function getColorAndClose(self, event) {
        self.style.display = "none"
        if (event.type == "change") {
            console.log(self.value)
        }
    }
</script>

<script src="dist/myeditor.js"></script>

<script>
    const data = `
    <h2>Hello ProseMirror</h2>
    <p>
        My ProseMirror editor
    </p>

    <p>
        <iframe video-type="youtube" src="https://youtube.com/embed/BkTI_b6cRNc" width="420" height="315" title="Youtube video" class="video"></iframe>
    </p>

    <p>
        <iframe video-type="youtube" src="https://youtube.com/embed/bsNM00eq7us" width="420" height="315" title="Youtube video" class="video"></iframe>
    </p>

    <p>
        <iframe video-type="youtube" src="https://player.vimeo.com/video/302637099" width="420" height="315" title="Youtube video" class="video"></iframe>
    </p>
    
    <p>
        <iframe video-type="youtube" src="https://www.dailymotion.com/embed/video/x8klbaq" width="420" height="315" title="Youtube video" class="video"></iframe>
    </p>

    <p>This paragraph has<br>a hard break inside of it.</p>

    <table>
        <tr>
            <td>1</td>
            <td>2</td>
            <td>3</td>
        </tr>
    </table>
    `;

    const options = {
        uploadActionURI: "http://localhost:8864/upload",
        uploadAccessURI: "http://localhost:8864/files",
    }
    const editorEL = document.querySelector("#editor")
    const editor = new MyEditor(data, editorEL, options)


    class modifierElement extends HTMLElement {
        constructor() {
            super()
            const templateContent = document.querySelector("#editor2-template").content
            const shadowRoot = this.attachShadow({ mode: "open" })
            shadowRoot.appendChild(templateContent.cloneNode(true))
        }
    }
    customElements.define("editor-other", modifierElement)

    const editor2ROOT = document.querySelector(`editor-other#editor2-1`).shadowRoot
    const editContent = "Hello ProseMirror"

    const editor2EL = editor2ROOT.querySelector("#editor2")
    const editor2Options = {
        uploadActionURI: "/api/uploader",
        uploadAccessURI: "/upload",
    }
    commentModifier = new MyEditor(editContent, editor2EL, editor2Options)


    function printHTML() { console.log(editor.getHTML()) }
    function clearContent() { editor.setHTML("") }

    document.addEventListener("DOMContentLoaded", async () => { })
</script>

</html>