<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google" content="notranslate" />

    <title>My Editor</title>
    <link rel="shortcut icon" href="#" type="image/x-icon">

    <link rel="stylesheet" href="css/editor.css">
</head>

<body>
    <div id="buttons">
        <button type="button" onclick="printHTML()">Print HTML to dev console</button>|
        <label for="image-upload">Image:</label>
        <input type="file" id="image-upload" multiple>
        <button type="button" onclick="insertImage()">Upload</button>
    </div>
    <div id="editor"></div>
</body>

<script>"use strict";</script>
<script src="dist/myeditor.js"></script>

<script>
    const data = `
    <h2>Hello PromiseMirror</h2>
    <p>
        A ProseMirror document is based on a schema, which determines the
        kind of elements that may occur in it, and the relation they have to
        each other. This one is based on the basic schema, with lists and
        tables added. It allows the usual <strong>strong</strong>
        and <em>emphasized</em> text, <code>code font</code>,
        and <a href="http://marijnhaverbeke.nl">links</a>.
    </p>

    <p>This paragraph has<br>a hard break inside of it.</p>

    <table>
        <tr>
            <td>1</td>
            <td>2</td>
            <td>3</td>
        </tr>
    </table>

    <iframe width="560" height="315" src="https://www.youtube.com/embed/ZUNaYWkFcuw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    `;

    const options = {
        uploadActionURI: "http://localhost:8864/upload",
        uploadAccessURI: "http://localhost:8864/files",
    }
    const editorEL = document.querySelector("#editor")
    const editor = new MyEditor(data, editorEL, options)

    function printHTML() { console.log(editor.getHTML()) }

    async function insertImage() {
        const uploadURI = "http://localhost:8864/upload"
        const accessURI = "http://localhost:8864/files"

        const files = document.querySelector("#image-upload").files
        for (const file of files) {
            if (file == undefined) { return } // Selected nothing

            const formData = new FormData()
            formData.append('file', file)

            const r = await fetch(uploadURI, { method: 'POST', body: formData })
            if (r.ok) {
                const result = await r.json()
                editor.insertImage(`${accessURI}/${result.storename}`)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", async () => {
        const buttonsEL = document.querySelector("#buttons")
        // const editorHeight = 200 + "px"
        // editorEL.style.height = editorHeight
        const editorMaxHeight = window.innerHeight - buttonsEL.offsetHeight - 2 + "px"
        editorEL.style.maxHeight = editorMaxHeight
    })
</script>

<style>
    body {
        margin: 0;
        padding: 0;
    }

    /*
     Need js for custom resize handle??? :
     https://spin.atomicobject.com/2019/11/21/creating-a-resizable-html-element
     */
    #editor {
        resize: vertical;
        overflow: auto;

        border: 1px solid silver;
    }
</style>

</html>